import{D as i,h as n,s as $}from"./hyphenate-65d9bac0.js";const N="aāiīuūṛṝeēoōkgṅcjñṭḍṇtdnpbmyrlvḻḷṟṉśṣsh".split("").reverse(),y=new Map;for(const[t,e]of N.entries())y.set(e,t);const _=(t,e,l="asc")=>{const s=Math.min(t.length,e.length);let a=0;for(;a<s;){const p=t.charAt(a).toLowerCase(),m=e.charAt(a).toLowerCase();if(p===m)a++;else{const d=y.get(p)||-1,h=y.get(m)||-1;return l==="asc"?d<h:d>h}}return l==="asc"?t.length>e.length:t.length<e.length};i.ext.type.search.tamil=t=>t?t.replace(/<.*?>|\u00AD/g,"").replace(/\s+/," ").toLowerCase():"";const f=t=>t?t.replace(/<.*?>|\u00AD/g,"").replace(/\s+/," ").toLowerCase():"";i.ext.type.order["tamil-asc"]=(t,e)=>_(f(t),f(e),"asc");i.ext.type.order["tamil-desc"]=(t,e)=>_(f(t),f(e),"desc");i.ext.type.order["shelfmark-pre"]=t=>t?t.replace(/\d+/g,e=>e.padStart(4,"0")):"0000";i.ext.type.order["extent-pre"]=t=>t.match(/^\d+ f?f.$/)?parseInt(t)*2:parseInt(t);i.ext.type.order["numrange-pre"]=t=>{if(t.match("–")){const e=t.split("–");return e[0]||e[1]}else return t};i.ext.type.order["hyphenated-pre"]=t=>t?t.replace(/<.*?>|\u00AD/g,"").replace(/\s+/g," ").toLowerCase():"";i.ext.type.search.hyphenated=t=>t?t.replace(/<.*?>|\u00AD/g,"").replace(/\s+/g," ").toLowerCase():"";const C=function(t){for(var e=t.target.closest("[data-anno]");e&&e.hasAttribute("data-anno");)w.make(t,e),e=e.parentNode},w={make:function(t,e){const l=e.dataset.anno;if(!l)return;var s=document.getElementById("tooltip");const a=document.createElement("div");if(s){for(const p of s.childNodes)if(p.myTarget===e)return;a.appendChild(document.createElement("hr"))}else s=document.createElement("div"),s.id="tooltip",s.style.top=t.clientY+10+"px",s.style.left=t.clientX+"px",document.body.appendChild(s),a.myTarget=e;a.appendChild(document.createTextNode(l)),a.myTarget=e,s.appendChild(a),e.addEventListener("mouseleave",w.remove,{once:!0}),s.animate([{opacity:0},{opacity:1,easing:"ease-in"}],200)},remove:function(t){const e=document.getElementById("tooltip");if(!e)return;if(e.children.length===1){e.remove();return}const l=t.target;for(const s of e.childNodes)if(s.myTarget===l){s.remove();break}if(e.children.length===1){const s=e.firstChild.firstChild;s.tagName==="HR"&&s.remove()}}},g=new Map([["shelfmark",{title:"shelfmark",type:"shelfmark",sql:"mss.filename, shelfmark",post:t=>`<a href="/mss/${t.filename}" class="shelfmark">${t.shelfmark}</a>`}],["repository",{sql:"repository",title:"repository"}],["title",{sql:"title",title:"title",type:"tamil",post:t=>n(t.title)}],["languages",{sql:"languages",title:"languages"}],["material",{sql:"material",title:"material"}],["width",{sql:"width",title:"width"}],["height",{sql:"height",title:"height"}],["extent",{sql:"extent",title:"extent",type:"extent"}],["date",{sql:"date",title:"date",type:"daterange"}],["images",{sql:"images",title:"images",post:t=>t.images?`<span class="smallcaps">${t.images}</span>`:""}],["blessing",{sql:"paratexts_blessing.text AS blessing",title:"blessing",table:"paratexts_blessing",type:"tamil",post:t=>n(t.blessing)}],["colophon",{sql:"paratexts_colophon.text AS colophon",title:"colophon",table:"paratexts_colophon",type:"tamil",post:t=>n(t.colophon)}],["header",{sql:"paratexts_header.text AS header",title:"header",table:"paratexts_header",type:"tamil",post:t=>n(t.header)}],["invocation",{sql:"paratexts_invocation.text AS invocation",title:"invocation",table:"paratexts_invocation",type:"tamil",post:t=>n(t.invocation)}],["ownership-statement",{sql:"[paratexts_ownership-statement].text AS [ownership-statement]",title:"ownership statement",table:"[paratexts_ownership-statement]",type:"tamil",post:t=>n(t["ownership-statement"])}],["satellite-stanza",{sql:"[paratexts_satellite-stanza].text AS [satellite-stanza]",title:"satellite stanza",table:"[paratexts_satellite-stanza]",type:"tamil",post:t=>n(t["satellite-stanza"])}],["table-of-contents",{sql:"[paratexts_table-of-contents].text AS [table-of-contents]",title:"table of contents",table:"[paratexts_table-of-contents]",type:"tamil",post:t=>n(t["table-of-contents"])}],["paratext_title",{sql:"paratexts_title.text AS paratext_title",title:"title",table:"[paratexts_title]",type:"tamil",post:t=>n(t.paratext_title)}],["tbc",{sql:"paratexts_TBC.text AS [tbc]",title:"TBC",table:"[paratexts_TBC]",type:"tamil",post:t=>n(t.tbc)}],["g_below-base",{sql:"[g_below-base].context AS [g_below-base], [g_below-base].text as [g_below-base_sort]",title:"ligature",table:"[g_below-base]",type:"tamil",render:{_:"display",sort:"sort"},post:t=>({display:n(t["g_below-base"]),sort:t["g_below-base_sort"]})}],["g_post-base",{sql:"[g_post-base].context AS [g_post-base], [g_post-base].text as [g_post-base_sort]",title:"ligature",table:"[g_post-base]",type:"tamil",render:{_:"display",sort:"sort"},post:t=>({display:n(t["g_post-base"]),sort:t["g_post-base_sort"]})}],["synch",{sql:"synch",title:"unit"}],["milestone",{sql:"milestone, facs",title:"page/folio",post:t=>t.milestone&&t.facs?`<a href="/mss/${t.filename}?facs=${t.facs}">${t.milestone}</a>`:t.milestone}],["placement",{sql:"placement",title:"placement"}]]),S=["Ancien fonds","Ariel","w/d","Burnouf","Cordier","Ducler","Haas","Reydellet","Vinson"];for(const t of S)g.set(`old_shelfmarks(${t})`,{title:"old shelfmark",type:"shelfmark",sql:`json_extract(old_shelfmarks, '$.${t}') AS 'old_shelfmarks(${t})'`});const B=async t=>{const e=await $("/mss/db/meta.db"),l=["shelfmark","repository","title","languages","material","extent","date","images"],s=[],a=[],p=t.dataset.sqlcolumns,m=p?p.split(", "):l,d=[];for(const c of m){const o=g.get(c);o&&(d.push(o.sql),o.table&&s.push(`INNER JOIN ${o.table} ON ${o.table}.filename = mss.filename`))}const h=t.dataset.collection;h&&(s.push("INNER JOIN collections ON collections.filename = mss.filename"),a.push(`collections.collection = "${h}"`));const b=t.dataset.repository;b&&a.push(`mss.repository = "${b}"`);const x=t.dataset.collector;x&&(s.push("INNER JOIN persons ON persons.filename = mss.filename"),a.push(`persons.persname = "${x}" AND persons.role = "collector"`));const q=d.join(", ")+" ",v=s.join(" "),k=a.length>0?`WHERE ${a.join(" AND ")}`:"",A=(await e.db.query(`SELECT ${q} FROM mss ${v} ${k} ORDER BY mss.filename`)).map(c=>{const o={};for(const r of m){const u=g.get(r);u?o[r]=u.post?u.post(c)||"":c[r]:o[r]=c[r]||""}return o}),E=m.map(c=>{const o=g.get(c),r={data:c,title:o.title};return o.type&&(r.type=o.type),o.render&&(r.render=o.render),r});return{rows:A,columns:E}};window.addEventListener("load",async()=>{const t=document.getElementById("index");if(!t)return;const e=await B(t);new i("#index",{searchable:!0,language:{search:"Filter:"},paging:!0,pageLength:100,lengthMenu:[[25,50,100,-1],[25,50,100,"All"]],sortable:!0,data:e.rows,columns:e.columns,scrollX:!0}),document.getElementById("spinner").style.display="none";const l=document.getElementById("tabright");l&&(l.style.visibility="visible"),document.getElementById("index").style.visibility="visible",t.addEventListener("mouseover",C)});

import{s as f}from"./hyphenate-65d9bac0.js";/* empty css                          *//* empty css              */import{S as p}from"./index-311b339f.js";import{m as h,g as E,a as q,v as B}from"./table-197e8b47.js";import"./network-85be2f71.js";const I=async t=>{const e=document.getElementById("personsspinner");e.style.display="flex";const s=await(await f("/mss/db/meta.db")).db.query("SELECT DISTINCT persname FROM persons WHERE role != ''");e.style.display="none";const c=document.getElementById("personsselect");for(const r of s){const o=document.createElement("option");o.value=p.escape(r.persname),o.append(" "+r.persname),t&&t.includes(o.value)&&o.toggleAttribute("selected"),c.append(o)}c.style.display="block",new B("#personsselect",{maxHeight:500,search:!0,placeHolder:"search names..."})},i=t=>{const e=t.querySelectorAll("input");if(e.item(1).type==="radio"){for(const n of e)if(n.checked)return n.value}else{const n=[];for(const s of e)s.checked&&n.push(s.value);return n}},v=async t=>{var a;const e=[],n=(a=document.getElementById("queryinput"))==null?void 0:a.value,s=i(document.getElementById("maincolumn")),c=i(document.getElementById("othercolumns")),r=[...document.getElementById("btn-group-personsselect").querySelectorAll("li.active")].filter(m=>m.dataset.value!=="all");s!=="mss"&&c.unshift(s),e.push(["sqlcolumns",c.join(", ")]),n&&(e.push(["searchcolumn",s]),e.push(["searchtext",n])),r.length>0&&e.push(["persons",JSON.stringify([...r].map(m=>m.dataset.value))]);const o=new URLSearchParams;for(const m of e)o.set(...m);window.location.search=o},k=t=>{const e=document.getElementById("mss").checked;for(const n of document.getElementsByClassName("notmss"))if(e){n.style.display="none";const s=n.querySelector("input");s&&(s.checked=!1)}else n.style.display="unset"},w=t=>{let e="";const n=new URLSearchParams(window.location.search),s=n.get("searchtext");if(s){t.dataset.searchtext=p.escape(`%${s}%`),document.getElementById("queryinput").value=s;const l=n.get("searchcolumn");if(l==="mss")t.dataset.searchcolumn="mss.shelfmark";else{const u=q.get(l),g=u.searchcolumn||u.table+".text";t.dataset.searchcolumn=g}document.getElementById(l).checked=!0;const d=document.querySelector(`label[for='${l}']`).textContent;e+=`<p><strong>Search:</strong> <em>${s}</em> <strong>in</strong> ${d}</p>`}const c=n.get("sqlcolumns");t.dataset.sqlcolumns=c;const r=[];for(const l of c.split(", "))document.getElementById(l).checked=!0,r.push(document.querySelector(`label[for='${l}']`).textContent);e+=`<p><strong>Table columns:</strong> ${r.join(", ")}`;const o=n.get("persons");let a=[];if(o){a=JSON.parse(o),t.dataset.persons=a.join(", ");const l=a.map(d=>d.replace(/^'/,"").replace(/'$/,"")).join(", ");e+=`<p><strong>Persons involved:</strong> ${l}`}e+='<p><button id="revisequery" style="display: none">Revise query</button></p>';const m=document.getElementById("queryparameters");m.innerHTML=e,document.getElementById("revisequery").addEventListener("click",S.bind(null,a))},S=t=>{document.getElementById("index_wrapper").style.display="none",document.getElementById("queryparameters").style.display="none",document.getElementById("tabright").style.display="none",document.getElementById("network").style.display="none",y(t)},y=t=>{document.getElementById("spinner").style.display="none",document.getElementById("queryparameters").style.display="none",document.getElementById("querycontainer").style.display="flex",I(t);const e=document.getElementById("maincolumn");for(const n of e.querySelectorAll("input"))n.addEventListener("change",k);document.getElementById("querybutton").addEventListener("click",v)};window.addEventListener("load",async()=>{if(window.location.search!==""){const t=document.getElementById("index");w(t),document.getElementById("queryparameters").style.display="flex",h(await E(t),t),document.getElementById("revisequery").style.display="block"}else y()});

import{s as f}from"./hyphenate-65d9bac0.js";/* empty css                          *//* empty css              */import{S as p,T as h}from"./transliterate-9268eaa3.js";import{m as E,g as q,a as B,v as I}from"./table-197e8b47.js";import"./network-85be2f71.js";import"https://tst-project.github.io/lib/js/sanscript.mjs";const v=async t=>{const e=document.getElementById("personsspinner");e.style.display="flex";const s=await(await f("/mss/db/meta.db")).db.query("SELECT DISTINCT persname FROM persons WHERE role != ''");e.style.display="none";const r=document.getElementById("personsselect");for(const c of s){const o=document.createElement("option");o.value=p.escape(c.persname),o.append(" "+c.persname),t&&t.includes(o.value)&&o.toggleAttribute("selected"),r.append(o)}r.style.display="block",new I("#personsselect",{maxHeight:500,search:!0,placeHolder:"search names..."})},i=t=>{const e=t.querySelectorAll("input");if(e.item(1).type==="radio"){for(const n of e)if(n.checked)return n.value}else{const n=[];for(const s of e)s.checked&&n.push(s.value);return n}},k=async t=>{var a;const e=[],n=(a=document.getElementById("queryinput"))==null?void 0:a.value,s=i(document.getElementById("maincolumn")),r=i(document.getElementById("othercolumns")),c=[...document.getElementById("btn-group-personsselect").querySelectorAll("li.active")].filter(m=>m.dataset.value!=="all");s!=="mss"&&r.unshift(s),e.push(["sqlcolumns",r.join(", ")]),n&&(e.push(["searchcolumn",s]),e.push(["searchtext",n])),c.length>0&&e.push(["persons",JSON.stringify([...c].map(m=>m.dataset.value))]);const o=new URLSearchParams;for(const m of e)o.set(...m);window.location.search=o},w=t=>{const e=document.getElementById("mss").checked;for(const n of document.getElementsByClassName("notmss"))if(e){n.style.display="none";const s=n.querySelector("input");s&&(s.checked=!1)}else n.style.display="unset"},S=t=>{let e="";const n=new URLSearchParams(window.location.search),s=n.get("searchtext");if(s){t.dataset.searchtext=p.escape(`%${h(s)}%`),document.getElementById("queryinput").value=s;const l=n.get("searchcolumn");if(l==="mss")t.dataset.searchcolumn="mss.shelfmark";else{const u=B.get(l),g=u.searchcolumn||u.table+".text";t.dataset.searchcolumn=g}document.getElementById(l).checked=!0;const d=document.querySelector(`label[for='${l}']`).textContent;e+=`<p><strong>Search:</strong> <em>${s}</em> <strong>in</strong> ${d}</p>`}const r=n.get("sqlcolumns");t.dataset.sqlcolumns=r;const c=[];for(const l of r.split(", "))document.getElementById(l).checked=!0,c.push(document.querySelector(`label[for='${l}']`).textContent);e+=`<p><strong>Table columns:</strong> ${c.join(", ")}`;const o=n.get("persons");let a=[];if(o){a=JSON.parse(o),t.dataset.persons=a.join(", ");const l=a.map(d=>d.replace(/^'/,"").replace(/'$/,"")).join(", ");e+=`<p><strong>Persons involved:</strong> ${l}`}e+='<p><button id="revisequery" style="display: none">Revise query</button></p>';const m=document.getElementById("queryparameters");m.innerHTML=e,document.getElementById("revisequery").addEventListener("click",b.bind(null,a))},b=t=>{document.getElementById("index_wrapper").style.display="none",document.getElementById("queryparameters").style.display="none",document.getElementById("tabright").style.display="none",document.getElementById("network").style.display="none",y(t)},y=t=>{document.getElementById("spinner").style.display="none",document.getElementById("queryparameters").style.display="none",document.getElementById("querycontainer").style.display="flex",v(t);const e=document.getElementById("maincolumn");for(const n of e.querySelectorAll("input"))n.addEventListener("change",w);document.getElementById("querybutton").addEventListener("click",k)};window.addEventListener("load",async()=>{if(window.location.search!==""){const t=document.getElementById("index");S(t),document.getElementById("queryparameters").style.display="flex",E(await q(t),t),document.getElementById("revisequery").style.display="block"}else y()});

import{s as h}from"./hyphenate-10dbe64e.js";import{S as y,T as E}from"./transliterate-0b1ac79b.js";import{m as q,g as B,a as I,v}from"./table-02bc200f.js";import"./network-a507e851.js";/* empty css              */import"https://tst-project.github.io/lib/js/sanscript.mjs";const k=async t=>{const e=document.getElementById("personsspinner");e.style.display="flex";const s=await(await h("/mss/db/meta.db")).db.query("SELECT DISTINCT persname FROM persons WHERE role != ''");e.style.display="none";const r=document.getElementById("personsselect");for(const c of s){const o=document.createElement("option");o.value=y.escape(c.persname),o.append(" "+c.persname),t&&t.includes(o.value)&&o.toggleAttribute("selected"),r.append(o)}r.style.display="block",new v("#personsselect",{maxHeight:500,search:!0,placeHolder:"search names..."})},i=t=>{const e=t.querySelectorAll("input");if(e.item(1).type==="radio"){for(const n of e)if(n.checked)return n.value}else{const n=[];for(const s of e)s.checked&&n.push(s.value);return n}},w=async t=>{var a;const e=[],n=(a=document.getElementById("queryinput"))==null?void 0:a.value,s=i(document.getElementById("maincolumn")),r=i(document.getElementById("othercolumns")),c=[...document.getElementById("btn-group-personsselect").querySelectorAll("li.active")].filter(m=>m.dataset.value!=="all");s!=="mss"&&r.unshift(s),e.push(["sqlcolumns",r.join(", ")]),n&&(e.push(["searchcolumn",s]),e.push(["searchtext",n])),c.length>0&&e.push(["persons",JSON.stringify([...c].map(m=>m.dataset.value))]);const o=new URLSearchParams;for(const m of e)o.set(...m);window.location.search=o},p=t=>{const e=document.getElementById("mss").checked;for(const n of document.getElementsByClassName("notmss"))if(e){n.style.display="none";const s=n.querySelector("input");s&&(s.checked=!1)}else n.style.display="unset"},b=t=>{let e="";const n=new URLSearchParams(window.location.search),s=n.get("searchtext");if(s){t.dataset.searchtext=y.escape(`%${E(s)}%`),document.getElementById("queryinput").value=s;const l=n.get("searchcolumn");if(l==="mss")t.dataset.searchcolumn="mss.shelfmark";else{const u=I.get(l),f=u.searchcolumn||u.table+".text";t.dataset.searchcolumn=f}document.getElementById(l).checked=!0;const d=document.querySelector(`label[for='${l}']`).textContent;e+=`<p><strong>Search:</strong> <em>${s}</em> <strong>in</strong> ${d}</p>`}const r=n.get("sqlcolumns");t.dataset.sqlcolumns=r;const c=[];for(const l of r.split(", "))document.getElementById(l).checked=!0,c.push(document.querySelector(`label[for='${l}']`).textContent);e+=`<p><strong>Table columns:</strong> ${c.join(", ")}`;const o=n.get("persons");let a=[];if(o){a=JSON.parse(o),t.dataset.persons=a.join(", ");const l=a.map(d=>d.replace(/^'/,"").replace(/'$/,"")).join(", ");e+=`<p><strong>Persons involved:</strong> ${l}`}e+='<p><button id="revisequery" style="display: none">Revise query</button></p>';const m=document.getElementById("queryparameters");m.innerHTML=e,document.getElementById("revisequery").addEventListener("click",S.bind(null,a))},S=t=>{document.getElementById("index_wrapper").style.display="none",document.getElementById("queryparameters").style.display="none",document.getElementById("tabright").style.display="none",document.getElementById("network").style.display="none",g(t)},g=t=>{document.getElementById("spinner").style.display="none",document.getElementById("queryparameters").style.display="none",document.getElementById("querycontainer").style.display="flex",k(t),p();const e=document.getElementById("maincolumn");for(const n of e.querySelectorAll("input"))n.addEventListener("change",p);document.getElementById("querybutton").addEventListener("click",w)};window.addEventListener("load",async()=>{if(window.location.search!==""){const t=document.getElementById("index");b(t),document.getElementById("queryparameters").style.display="flex",q(await B(t),t),document.getElementById("revisequery").style.display="block"}else g()});
